@using Newtonsoft.Json;

@model Agencia.Models.Hotel

@{
    ViewData["Title"] = "ResultadosDeLaBusqueda";
}

@foreach (var item in ViewBag.hotelesSeleccionados)
{
    var id = item.id;
    var nombre = item.nombre;
    var imagen = item.imagen;
    var descripcion = item.descripcion;
    var costo = item.costo;

    double personas = ViewBag.total_adultos + (ViewBag.total_menores - ViewBag.total_menores * 0.15);
    double impuesto_pais = costo * 0.3;
    double RG_4815 = costo * 0.45;
    double RG_5272 = costo * 0.05;
    double impuestos = impuesto_pais + RG_4815 + RG_5272;
    double descuento = Math.Round(costo * 0.0661, 2);
    double suma_total = costo + impuestos - descuento;
    double precio_por_persona = suma_total / ViewBag.total_personas;

    <div class="box-container">
        <div class="box row d-flex">
            <div class="col-md-4 p-0 hotel-image">
                @if (!string.IsNullOrEmpty(imagen))
                {
                    <img src="~/@imagen" alt="Imagen del hotel" />
                }
                else
                {
                    <img src="~/images/noImageFound.png" alt="Imagen no encontrada" />
                }
            </div>
            <div class="content border-end col-md-5">
                <h3 class="fs-4 fw-semibold m-0"><i class="bx bxs-map icon"></i> @nombre</h3>
                <p class="location-distance p-0 m-0 mb-2">
                    @descripcion
                    <a href="#" class="text-decoration-none ms-1 map">Ver en mapa</a>
                </p>
                <div class="stars mb-2 fs-6">
                    <span class="fw-semibold rating me-1 py-0">8.1</span>
                    <i class="bx bxs-star icon">
                        <i class="bx bxs-star icon">
                            <i class="bx bxs-star icon">
                                <i class="bx bxs-star icon"><i class="bx bx-star icon"></i></i>
                            </i>
                        </i>
                    </i>
                </div>
                <span class="px-2 fw-semibold capacity-alert">Solo quedan 3</span>
            </div>
            <div class="mt-3 payment-info col-md-3">
                <p class="mb-0">Alojamiento</p>
                <p class="mb-1">Precio final por persona</p>
                <div class="d-flex align-items-center">
                    <i type="button" class="bx bx-info-circle icon fs-4 text-primary pe-2"
                       data-bs-toggle="modal" data-bs-target="#payment-modal"></i>
                    <div class="modal fade" id="payment-modal" tabindex="-1" aria-labelledby="title"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content modal-width p-2">
                                <div class="modal-body pb-0 border-bottom">
                                    <div class="row d-flex justify-content-between">
                                        <h1 class="fs-4 fw-semibold col-10 mb-0">
                                            Detalle de precio
                                        </h1>
                                        <button type="button" class="btn-close col-2 fs-5 pe-4"
                                                data-bs-dismiss="modal" aria-label="Close">
                                        </button>
                                    </div>
                                    @if (ViewBag.total_menores == 0 && ViewBag.total_adultos == 1)
                                    {
                                        <p class="d-block">Para @ViewBag.total_adultos adulto</p>
                                    }
                                    else if (ViewBag.total_menores == 0 && ViewBag.total_adultos > 1)
                                    {
                                        <p class="d-block">Para @ViewBag.total_adultos adultos</p>
                                    }
                                    else if (ViewBag.total_menores > 1 && ViewBag.total_adultos > 1)
                                    {
                                        <p class="d-block">Para @ViewBag.total_adultos adultos y @ViewBag.total_menores menores </p>
                                    }
                                    else
                                    {
                                        <p class="d-block">
                                            Para @ViewBag.total_adultos adultos adultos y @ViewBag.total_menores menor
                                        </p>
                                    }
                                    <p class="d-block text-body text-opacity-50">Ida y vuelta directo</p>
                                    <div class="row d-flex payment-small-font">
                                        <p class="col-9 mb-0">Alojamiento</p>
                                        <p class="col-3 mb-0 px-0 text-end pe-3">$ @costo</p>
                                    </div>
                                    <p class="d-block text-body text-opacity-50">
                                        @nombre x @ViewBag.cantDias noches
                                    </p>
                                </div>
                                <div class="modal-body pb-0 border-bottom">
                                    <div class="row d-flex payment-small-font">
                                        <p class="col-9 mb-2">Precio Total</p>
                                        <p class="col-3 mb-2 px-0 text-end pe-3">$ @costo</p>
                                    </div>
                                    <div class="row d-flex payment-small-font">
                                        <p class="col-9 mb-0">Impuestos, tasas y cargos incluidos</p>
                                        <p class="col-3 mb-0 px-0 text-end pe-3">
                                            $@impuestos
                                        </p>
                                    </div>
                                    <p class="d-block text-body text-opacity-50">
                                        Incluye Impto. PAIS y
                                        Percepciones RG 4815 y 5272
                                    </p>
                                    <div class="row d-flex text-success payment-small-font">
                                        <p class="col-9 mb-2">Ahorro paquete</p>
                                        <p class="col-3 mb-2 px-0 text-end pe-3 text-nowrap">
                                            - $@descuento
                                        </p>
                                    </div>
                                </div>
                                <div class="row d-flex justify-content-between fw-semibold ps-3 pe-3 pt-2 payment-small-font">
                                    @if (ViewBag.personas > 1)
                                    {
                                        <p class="col-9">Final @ViewBag.total_personas personas</p>
                                    }
                                    else
                                    {
                                        <p class="col-9">Final @ViewBag.total_personas persona</p>
                                    }

                                    <p class="col-3 px-0 text-end pe-3 text-nowrap">
                                        $@suma_total
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="fs-6 mb-0">$ <span class="fs-4">@precio_por_persona</span></p>
                </div>
                @if (ViewBag.total_personas > 1)
                {
                    <p class="fw-semibold mb-0 text-nowrap">Final @ViewBag.total_personas personas <span>$@suma_total</span></p>
                }
                else
                {
                    <p class="fw-semibold mb-0 text-nowrap">Final @ViewBag.total_personas persona <span>$@suma_total</span></p>
                }
                <p class="tax-message">Incluye Impto. PAIS y Percepciones</p>
                <button class="btn btn-warning rounded-pill reservar-hotel"
                        data-hotel_id="@id"
                        data-fecha_desde="@ViewBag.fecha_desde"
                        data-fecha_hasta="@ViewBag.fecha_hasta"
                        data-suma_total="@suma_total"
                        data-habitaciones_chicas="@ViewBag.habitaciones_chicas"
                        data-habitaciones_medianas="@ViewBag.habitaciones_medianas"
                        data-habitaciones_grandes="@ViewBag.habitaciones_grandes"
                        data-total_personas="@ViewBag.total_personas">
                    Comprar
                </button>

            </div>
        </div>
    </div>
}